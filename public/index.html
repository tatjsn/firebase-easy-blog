<!DOCTYPE html>
<html>
  <body>
    <div id=app>Now loading...</div>
    <script>
     function selectPath(doc) {
         const p = doc.name.match(/\/posts\/(.*)/);
         return p[0];
     }
     function selectTitle(doc) {
         return doc.fields.title.stringValue;
     }
     async function run() {
         if (location.pathname === '/') {
             const response = await fetch('https://firestore.googleapis.com/v1/projects/coolblog-c1617/databases/(default)/documents/posts?mask.fieldPaths=name&mask.fieldPaths=title');
             const payload = await response.json();
             const html = payload.documents.map(doc => `<li><a href="${selectPath(doc)}">${selectTitle(doc)}</a></li>`).join('');
             document.getElementById('app').innerHTML = html;
         } else if (location.pathname.startsWith('/posts/')) {
             const id = location.pathname.slice(7);
             const response = await fetch(`https://firestore.googleapis.com/v1/projects/coolblog-c1617/databases/(default)/documents/posts/${id}`);
             const payload = await response.json();
             const { title, body, type } = Object.fromEntries(Object.entries(payload.fields).map(([key, value]) => [key, value.stringValue]));
             const html = `<h1>${title}</h1><p>${body}</p><p>Category: ${type}</p><p><a href="/">Back to index</a></p>`;
             document.getElementById('app').innerHTML = html;
         } else {
             document.getElementById('app').innerHTML = `Not found: ${location.pathname}`;
         }
     }
     run();
    </script>
  </body>
</html>
